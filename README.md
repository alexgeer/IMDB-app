a rather basic implementation that nonetheless works. I'm wincing looking at this code. 
